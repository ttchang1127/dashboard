<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>土木工程碳排計算器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #f0f4f8;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            margin-bottom: 1.5rem;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .input-group {
            display: grid;
            grid-template-columns: 2fr 2fr 1fr;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .input-group:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        .input-group label {
            font-weight: 500;
            color: #374151;
        }
        .input-group input {
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            width: 100%;
        }
        .input-group .unit {
            color: #6b7280;
            white-space: nowrap;
        }
        .total-card {
            position: sticky;
            top: 1.5rem;
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            color: white;
        }
        /* Responsive adjustments for smaller screens */
        @media (max-width: 640px) {
            .input-group {
                grid-template-columns: 1fr;
                gap: 0.5rem;
                text-align: center;
            }
            .input-group label {
                margin-bottom: 0.25rem;
            }
             .input-group .unit {
                justify-self: center;
             }
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">工程碳排計算器</h1>
            <p class="text-gray-600 mt-2">依據水利署公布之碳盤查係數計算</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Column 1 & 2: Emission & Reduction Items -->
            <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <!-- Column 1: Emission Items -->
                <div class="space-y-6">
                    <!-- 鋼筋/鋼網 -->
                    <div class="card">
                        <button class="accordion-toggle flex items-center justify-between w-full p-4 text-xl font-bold text-blue-600">
                            <span>鋼筋 / 銲接鋼線網</span>
                            <svg class="w-6 h-6 transform transition-transform shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4">
                                <div class="input-group"><label for="rebar-sd280w">鋼筋 SD280W</label><input type="number" id="rebar-sd280w" placeholder="0" oninput="calculateEmissions()"><span class="unit">噸 (ton)</span></div>
                                <div class="input-group"><label for="rebar-sd420w">鋼筋 SD420W</label><input type="number" id="rebar-sd420w" placeholder="0" oninput="calculateEmissions()"><span class="unit">噸 (ton)</span></div>
                                <div class="input-group"><label for="welded-wire">銲接鋼線網</label><input type="number" id="welded-wire" placeholder="0" oninput="calculateEmissions()"><span class="unit">M²</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- 模板 -->
                     <div class="card">
                        <button class="accordion-toggle flex items-center justify-between w-full p-4 text-xl font-bold text-blue-600">
                            <span>模板 / 附屬品</span>
                            <svg class="w-6 h-6 transform transition-transform shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4">
                                <div class="input-group"><label for="formwork-metal">金屬模板</label><input type="number" id="formwork-metal" placeholder="0" oninput="calculateEmissions()"><span class="unit">M²</span></div>
                                <div class="input-group"><label for="formwork-wood">一般木模板</label><input type="number" id="formwork-wood" placeholder="0" oninput="calculateEmissions()"><span class="unit">M²</span></div>
                                <div class="input-group"><label for="formwork-plastic">塑膠模板</label><input type="number" id="formwork-plastic" placeholder="0" oninput="calculateEmissions()"><span class="unit">M²</span></div>
                                <div class="input-group"><label for="joint-filler">填縫板</label><input type="number" id="joint-filler" placeholder="0" oninput="calculateEmissions()"><span class="unit">M²</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- 土方/開挖 -->
                    <div class="card">
                        <button class="accordion-toggle flex items-center justify-between w-full p-4 text-xl font-bold text-blue-600">
                            <span>土方 / 擋土 / 基礎</span>
                            <svg class="w-6 h-6 transform transition-transform shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4">
                                <div class="input-group"><label for="demolition-concrete">機械拆除，無筋混凝土</label><input type="number" id="demolition-concrete" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                                <div class="input-group"><label for="earthwork-excavation">土方工作，挖方</label><input type="number" id="earthwork-excavation" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                                <div class="input-group"><label for="earthwork-filling">土方工作，填方</label><input type="number" id="earthwork-filling" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                                <div class="input-group"><label for="earthwork-backfill">土方工作，回填方</label><input type="number" id="earthwork-backfill" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                                <div class="input-group"><label for="sheet-pile">臨時擋土樁設施，鋼板樁</label><input type="number" id="sheet-pile" placeholder="0" oninput="calculateEmissions()"><span class="unit">M</span></div>
                                <div class="input-group"><label for="bored-pile">場鑄樁，全套管式</label><input type="number" id="bored-pile" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                                 <div class="input-group"><label for="micropile">鑽掘(微型)樁</label><input type="number" id="micropile" placeholder="0" oninput="calculateEmissions()"><span class="unit">M</span></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Column 2: Emission & Reduction Items Continued -->
                 <div class="space-y-6">
                    <!-- 混凝土/水泥砂漿 -->
                    <div class="card">
                        <button class="accordion-toggle flex items-center justify-between w-full p-4 text-xl font-bold text-blue-600">
                            <span>混凝土 / 水泥砂漿</span>
                            <svg class="w-6 h-6 transform transition-transform shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4">
                                <div class="input-group"><label for="concrete-140">混凝土 140 kgf/cm²</label><input type="number" id="concrete-140" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                                <div class="input-group"><label for="concrete-175">混凝土 175 kgf/cm²</label><input type="number" id="concrete-175" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                                <div class="input-group"><label for="concrete-210">混凝土 210 kgf/cm²</label><input type="number" id="concrete-210" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                                <div class="input-group"><label for="concrete-245">混凝土 245 kgf/cm²</label><input type="number" id="concrete-245" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                                <div class="input-group"><label for="concrete-280">混凝土 280 kgf/cm²</label><input type="number" id="concrete-280" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                                <div class="input-group"><label for="concrete-315">混凝土 315 kgf/cm²</label><input type="number" id="concrete-315" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                                <div class="input-group"><label for="concrete-350">混凝土 350 kgf/cm²</label><input type="number" id="concrete-350" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                                <div class="input-group"><label for="precast-concrete">預鑄混凝土</label><input type="number" id="precast-concrete" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                                <div class="input-group"><label for="clsm">控制性低強度回填材料(CLSM)</label><input type="number" id="clsm" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                                <div class="input-group"><label for="mortar">水泥砂漿</label><input type="number" id="mortar" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                                <div class="input-group"><label for="mortar-plastering">水泥砂漿粉刷</label><input type="number" id="mortar-plastering" placeholder="0" oninput="calculateEmissions()"><span class="unit">M²</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- 舖面/基底層 -->
                    <div class="card">
                        <button class="accordion-toggle flex items-center justify-between w-full p-4 text-xl font-bold text-blue-600">
                           <span>舖面 / 基底層</span>
                           <svg class="w-6 h-6 transform transition-transform shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4">
                                 <div class="input-group"><label for="base-course">級配粒料底層</label><input type="number" id="base-course" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                                 <div class="input-group"><label for="subbase-course">級配粒料基層</label><input type="number" id="subbase-course" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                                 <div class="input-group"><label for="asphalt-pavement">瀝青混凝土舖面</label><input type="number" id="asphalt-pavement" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                                 <div class="input-group"><label for="permeable-asphalt">多孔隙瀝青混凝土舖面</label><input type="number" id="permeable-asphalt" placeholder="0" oninput="calculateEmissions()"><span class="unit">M³</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Column 3: Results -->
            <div>
                <!-- 植栽減碳 -->
                <div class="card p-4">
                    <h3 class="text-xl font-bold text-green-600 text-center mb-4">減碳項目 (碳吸收)</h3>
                    <table class="w-full text-sm">
                        <thead class="border-b-2 border-gray-200">
                            <tr>
                                <th class="p-2 text-left font-semibold text-gray-700">項目</th>
                                <th class="p-2 text-center font-semibold text-gray-700">數量</th>
                                <th class="p-2 text-center font-semibold text-gray-700">年期</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b border-gray-100">
                                <td class="p-2 font-medium text-gray-800">植喬木</td>
                                <td class="p-2">
                                    <div class="flex items-center justify-center">
                                        <input id="plant-tree" type="number" placeholder="0" oninput="calculateEmissions()" class="w-20 text-center border rounded-md p-1">
                                        <span class="ml-2 text-gray-600">株</span>
                                    </div>
                                </td>
                                <td class="p-2">
                                     <div class="flex items-center justify-center">
                                        <input id="plant-tree-time" type="number" value="1" min="1" oninput="calculateEmissions()" class="w-20 text-center border rounded-md p-1">
                                        <span class="ml-2 text-gray-600">年</span>
                                    </div>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-100">
                                <td class="p-2 font-medium text-gray-800">植灌木</td>
                                <td class="p-2">
                                    <div class="flex items-center justify-center">
                                        <input id="plant-shrub" type="number" placeholder="0" oninput="calculateEmissions()" class="w-20 text-center border rounded-md p-1">
                                        <span class="ml-2 text-gray-600">株</span>
                                    </div>
                                </td>
                                <td class="p-2">
                                     <div class="flex items-center justify-center">
                                        <input id="plant-shrub-time" type="number" value="1" min="1" oninput="calculateEmissions()" class="w-20 text-center border rounded-md p-1">
                                        <span class="ml-2 text-gray-600">年</span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="p-2 font-medium text-gray-800">植草皮</td>
                                <td class="p-2">
                                    <div class="flex items-center justify-center">
                                        <input id="plant-lawn" type="number" placeholder="0" oninput="calculateEmissions()" class="w-20 text-center border rounded-md p-1">
                                        <span class="ml-2 text-gray-600">M²</span>
                                    </div>
                                </td>
                                <td class="p-2">
                                     <div class="flex items-center justify-center">
                                        <input id="plant-lawn-time" type="number" value="1" min="1" oninput="calculateEmissions()" class="w-20 text-center border rounded-md p-1">
                                        <span class="ml-2 text-gray-600">年</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="card total-card p-6">
                    <h2 class="text-xl font-bold mb-4 text-center">計算結果</h2>
                    <div class="text-center">
                        <p class="text-lg mb-2">合計碳排量</p>
                        <p id="total-emissions" class="text-4xl font-extrabold">0.00</p>
                        <p class="text-lg mt-1">公斤 CO₂e</p>
                    </div>
                    <hr class="my-6 border-blue-200">
                    <div>
                        <p id="emissions-positive" class="text-lg">總排放量: 0.00 kg CO₂e</p>
                        <p id="emissions-negative" class="text-lg mt-2">總減碳量: 0.00 kg CO₂e</p>
                    </div>
                     <div class="text-center mt-6">
                        <p class="text-xl text-green-200">減碳比例</p>
                        <p id="reduction-percentage" class="text-4xl font-extrabold text-lime-300 mt-1">0.00 %</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.querySelectorAll('.accordion-toggle').forEach(button => {
            button.addEventListener('click', () => {
                const accordionContent = button.nextElementSibling;
                const svg = button.querySelector('svg');

                // Close other open accordions
                document.querySelectorAll('.accordion-content').forEach(content => {
                    if (content !== accordionContent && content.style.maxHeight) {
                        content.style.maxHeight = null;
                        content.previousElementSibling.querySelector('svg').style.transform = 'rotate(0deg)';
                    }
                });

                if (accordionContent.style.maxHeight) {
                    accordionContent.style.maxHeight = null;
                    svg.style.transform = 'rotate(0deg)';
                } else {
                    accordionContent.style.maxHeight = accordionContent.scrollHeight + "px";
                    svg.style.transform = 'rotate(180deg)';
                } 
            });
        });

        const factors = {
            'demolition-concrete': 13.641, // M3
            'sheet-pile': 14.5, // M
            'earthwork-excavation': 0.981, // M3
            'earthwork-filling': 1.339, // M3
            'earthwork-backfill': 0.736, // M3
            'bored-pile': 20.373, // M3
            'micropile': 2.502, // M
            'base-course': 19.387, // M3
            'subbase-course': 19.387, // M3
            'asphalt-pavement': 105.811, // M3
            'permeable-asphalt': 105.811, // M3
            'concrete-140': 262, // M3
            'concrete-175': 282, // M3
            'concrete-210': 306, // M3
            'concrete-245': 329, // M3
            'concrete-280': 355, // M3
            'concrete-315': 381, // M3
            'concrete-350': 405, // M3
            'formwork-metal': 5.0, // M2
            'formwork-wood': 8.0, // M2
            'formwork-plastic': 3.12, // M2
            'joint-filler': 2.76, // M2
            'rebar-sd280w': 683, // T
            'rebar-sd420w': 683, // T
            'welded-wire': 2.38, // M2
            'precast-concrete': 293.004, // M3
            'clsm': 200.56, // M3
            'mortar': 275.68, // M3
            'mortar-plastering': 6.2, // M2
            'plant-tree': -12,
            'plant-shrub': -3,
            'plant-lawn': -0.5
        };

        function calculateEmissions() {
            let totalPositive = 0;
            let totalNegative = 0;

            for (const id in factors) {
                const element = document.getElementById(id);
                if (element) {
                    const value = parseFloat(element.value) || 0;
                    const factor = factors[id];
                    let emission = value * factor;

                    if (factor > 0) {
                        totalPositive += emission;
                    } else {
                        // Handle reduction items with time multiplier
                        const timeElement = document.getElementById(`${id}-time`);
                        if (timeElement) {
                            const timeValue = parseFloat(timeElement.value) || 1;
                            emission *= timeValue;
                        }
                        totalNegative += emission;
                    }
                }
            }

            const totalEmissions = totalPositive + totalNegative;
            let reductionPercentage = 0;
            if (totalPositive > 0) {
                reductionPercentage = ((-totalNegative) / totalPositive) * 100;
            }

            document.getElementById('total-emissions').textContent = totalEmissions.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('emissions-positive').textContent = `總排放量: ${totalPositive.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})} kg CO₂e`;
            document.getElementById('emissions-negative').textContent = `總減碳量: ${(-totalNegative).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})} kg CO₂e`;
            document.getElementById('reduction-percentage').textContent = `${reductionPercentage.toFixed(2)} %`;
        }
        
        // Initial calculation on page load
        window.onload = calculateEmissions;
    </script>
</body>
</html>
