<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº’å‹•å¼é åŠ›æ··å‡åœŸæ©‹æ¢æª¢æ ¸æŒ‡å—_è…¹ç‰ˆåŠä¸‹ç¿¼ç‰ˆ v25</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU07EWHEZrWCsZQAAEoAxpHy2xAftGTgWFSgC8BH31ZSFcvlALTMWC_">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" xintegrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"></script>
    
    <!-- Chosen Palette: Warm Neutrals (Stone, Slate, Sky, Amber) -->
    <!-- Application Structure Plan: Made the "Durability Performance Check" interactive by adding inputs for fatigue and corrosion moments. The app now calculates the resulting steel stress and compares it against code limits. -->
    <!-- Visualization & Content Choices: Added input fields for fatigue/corrosion moments and display spans for calculated stresses. Implemented `calculateSteelStress` based on cracked transformed section analysis. Updated `updateCheckResults` to use this new logic. The `xintegrity` typo is definitively corrected to `integrity`. -->
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .active-btn {
            background-color: #0284c7; /* sky-600 */
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            z-index: 10;
        }
        .inactive-btn {
            background-color: #e2e8f0; /* slate-200 */
            color: #475569; /* slate-600 */
        }
        .result-box {
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-size: 1.125rem;
            line-height: 1.75rem;
            font-weight: 700;
            text-align: center;
        }
        .ok-result {
            background-color: #dcfce7; /* green-100 */
            color: #166534; /* green-800 */
        }
        .ng-result {
            background-color: #fee2e2; /* red-100 */
            color: #991b1b; /* red-800 */
        }
        dl dd {
             padding-left: 0.5rem;
        }
        .rebar-input-group {
             display: grid;
             grid-template-columns: 1fr 1fr;
             gap: 0.5rem;
        }
        #section-canvas {
            width: 100%;
            max-width: 400px;
            height: auto;
            aspect-ratio: 800 / 500;
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">äº’å‹•å¼é åŠ›æ··å‡åœŸæ©‹æ¢æª¢æ ¸æŒ‡å—_è…¹ç‰ˆåŠä¸‹ç¿¼ç‰ˆ</h1>
            <p class="mt-2 text-lg text-slate-600 max-w-4xl mx-auto">æœ¬æª¢æ ¸æŒ‡å—åŸºæ–¼æ—¥æœ¬ã€Šé“è·¯æ©‹ç¤ºæ–¹æ›¸ã€‹é€²è¡Œï¼Œæ¡ç”¨ä»¥æ€§èƒ½ç‚ºåŸºç¤çš„è¨­è¨ˆæ–¹æ³•ã€‚æ‰€æœ‰æª¢æ ¸å‡åŸºæ–¼ä¸€å€‹ä¸‰è·¨é€£çºŒPCç®±å‹æ¢æ©‹çš„ç¯„ä¾‹ï¼Œå…¶è¨­è¨ˆä½¿ç”¨å¹´é™ç‚º100å¹´ã€‚ä»¥ä¸‹å°‡é€ä¸€æª¢æ ¸è¨­è¨ˆä¸­çš„é—œéµç’°ç¯€ã€‚</p>
        </header>

        <div class="max-w-7xl mx-auto">
            
            <div class="bg-white p-6 rounded-xl shadow-md mb-8">
                 <h2 class="text-xl font-bold mb-4 text-sky-800 text-center">æ–·é¢åƒè€ƒåœ–</h2>
                 <img src="https://lh3.googleusercontent.com/d/19ARfsgIyCDvLXvSsZnsbTKY4WaA834V7" alt="æ©‹æ¢æ–·é¢åœ–" class="rounded-lg object-contain w-full max-w-4xl mx-auto">
            </div>

            <div class="mb-8 text-center">
                <p class="mb-3 text-lg font-medium">è«‹é¸æ“‡è¦æª¢æ ¸çš„éƒ¨ä½ç·¨è™Ÿï¼š</p>
                <div id="section-selector" class="inline-flex flex-wrap justify-center rounded-lg shadow-sm" role="group">
                    <button type="button" id="btn-sec15" data-section="sec15" class="px-5 py-3 text-base font-medium rounded-l-lg transition-colors duration-300">Sec-15</button>
                    <button type="button" id="btn-sec16" data-section="sec16" class="px-5 py-3 text-base font-medium transition-colors duration-300">Sec-16</button>
                    <button type="button" id="btn-sec24" data-section="sec24" class="px-5 py-3 text-base font-medium transition-colors duration-300">Sec-24</button>
                    <button type="button" id="btn-sec25" data-section="sec25" class="px-5 py-3 text-base font-medium rounded-r-lg transition-colors duration-300">Sec-25</button>
                </div>
            </div>
            
            <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Left Column: Inputs (50%) -->
                <aside class="lg:col-span-1">
                    <div class="bg-white p-6 rounded-xl shadow-md h-full">
                        <h2 class="text-xl font-bold mb-4 text-sky-800">æ–·é¢æ€§è³ªèˆ‡æŠµæŠ—èƒ½åŠ› (å¯ç·¨è¼¯)</h2>
                        <div id="properties-display" class="space-y-4 text-slate-700">
                            <!-- Dynamic content here -->
                        </div>
                    </div>
                </aside>

                <!-- Right Column: Results (50%) -->
                <section class="lg:col-span-1">
                    <div class="bg-white p-6 rounded-xl shadow-md h-full space-y-6">
                        <div id="merged-check-block">
                            <h2 class="text-xl font-bold text-sky-800">ğŸ›¡ï¸ è€è·æ€§èƒ½æª¢æ ¸</h2>
                            <div class="mt-2 space-y-4">
                               <div class="grid grid-cols-2 gap-4">
                                    <div class="p-3 bg-slate-100 rounded-lg">
                                        <label for="design-moment-ls1" class="block text-sm font-medium text-slate-700 mb-1">è¨­è¨ˆå½çŸ© \(M_{d,1}\)</label>
                                        <div class="relative">
                                            <input type="number" step="0.1" id="design-moment-ls1" class="w-full p-2 border rounded-md bg-white text-center text-sm pr-12">
                                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 text-xs">kNÂ·m</span>
                                        </div>
                                    </div>
                                     <div class="p-3 bg-slate-100 rounded-lg">
                                        <label for="design-moment-ls3" class="block text-sm font-medium text-slate-700 mb-1">è¨­è¨ˆå½çŸ© \(M_{d,3}\)</label>
                                         <div class="relative">
                                            <input type="number" step="0.1" id="design-moment-ls3" class="w-full p-2 border rounded-md bg-white text-center text-sm pr-12">
                                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 text-xs">kNÂ·m</span>
                                        </div>
                                    </div>
                               </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="p-3 bg-sky-50 rounded-lg">
                                        <label class="block text-sm font-medium text-sky-800 mb-2">è¨ˆç®—é™ä¼å½çŸ© \(M_{yc}\) (kNÂ·m)</label>
                                        <div class="grid grid-cols-2 gap-2 text-center">
                                             <div>
                                                <div id="myc-pos-display" class="text-lg font-bold text-sky-900">---</div>
                                                <div class="text-xs text-slate-500">æ­£å½çŸ©</div>
                                             </div>
                                              <div>
                                                <div id="myc-neg-display" class="text-lg font-bold text-sky-900">---</div>
                                                <div class="text-xs text-slate-500">è² å½çŸ©</div>
                                             </div>
                                        </div>
                                    </div>
                                    <div class="p-3 bg-amber-50 rounded-lg">
                                        <label class="block text-sm font-medium text-amber-800 mb-2">è¨ˆç®—ç ´å£å½çŸ© \(M_{uc}\) (kNÂ·m)</label>
                                        <div class="grid grid-cols-2 gap-2 text-center">
                                             <div>
                                                <div id="muc-pos-display" class="text-lg font-bold text-amber-900">---</div>
                                                <div class="text-xs text-slate-500">æ­£å½çŸ©</div>
                                             </div>
                                              <div>
                                                <div id="muc-neg-display" class="text-lg font-bold text-amber-900">---</div>
                                                <div class="text-xs text-slate-500">è² å½çŸ©</div>
                                             </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                             <div class="grid grid-cols-2 gap-4 mt-4 text-center">
                                <div>
                                    <h3 class="font-semibold text-slate-700 mb-1 text-sm">æ¥µé™ç‹€æ…‹1</h3>
                                    <div id="load-bearing-result-1" class="result-box"></div>
                                    <div class="text-xs mt-1 text-slate-500">
                                        <span>æ¯”å€¼ \(|M_{d,1}/M_{yc}|\)</span>
                                        <span id="ratio-ls1" class="font-bold">---</span>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-slate-700 mb-1 text-sm">æ¥µé™ç‹€æ…‹3</h3>
                                    <div id="load-bearing-result-3" class="result-box"></div>
                                     <div class="text-xs mt-1 text-slate-500">
                                        <span>æ¯”å€¼ \(|M_{d,3}/M_{uc}|\)</span>
                                        <span id="ratio-ls3" class="font-bold">---</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="border-t pt-6">
                            <h2 class="text-xl font-bold text-sky-800">ğŸ”„ ç›¸åæ‡‰åŠ›æ§‹ä»¶æª¢æ ¸</h2>
                            <div class="mt-2 space-y-3">
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="p-2 bg-slate-100 rounded-lg">
                                        <label for="moment-d" class="block text-sm font-medium text-slate-700 mb-1">æ°¸ä¹…è·è¼‰å½çŸ© \(M_D\)</label>
                                        <div class="relative">
                                            <input type="number" step="0.1" id="moment-d" class="w-full p-2 border rounded-md bg-white text-center text-sm pr-12">
                                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 text-xs">kNÂ·m</span>
                                        </div>
                                    </div>
                                    <div class="p-2 bg-slate-100 rounded-lg">
                                        <label for="moment-l" class="block text-sm font-medium text-slate-700 mb-1">æ´»è·è¼‰å½çŸ© \(M_L\)</label>
                                        <div class="relative">
                                            <input type="number" step="0.1" id="moment-l" class="w-full p-2 border rounded-md bg-white text-center text-sm pr-12">
                                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 text-xs">kNÂ·m</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-center text-sm text-slate-500">
                                    æ¯”å€¼ \(|M_D/M_L|\): <span id="dl-ratio" class="font-bold">---</span>
                                </div>
                                <div class="text-center">
                                     <h3 class="font-semibold text-slate-700 mb-1 text-sm">æª¢æ ¸çµæœ</h3>
                                     <div id="reversing-stress-result" class="result-box"></div>
                                </div>
                            </div>
                        </div>
                         <div class="border-t pt-6">
                            <h2 class="text-xl font-bold text-sky-800">â³ è€ä¹…æ€§èƒ½æª¢æ ¸</h2>
                            <div class="mt-2 space-y-3">
                                <div class="grid grid-cols-2 gap-4">
                                     <div class="p-2 bg-slate-100 rounded-lg">
                                        <label for="moment-fatigue" class="block text-sm font-medium text-slate-700 mb-1">ç–²å‹æª¢æ ¸å½çŸ© \(M_{fat}\)</label>
                                        <div class="relative">
                                            <input type="number" step="0.1" id="moment-fatigue" class="w-full p-2 border rounded-md bg-white text-center text-sm pr-12">
                                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 text-xs">kNÂ·m</span>
                                        </div>
                                    </div>
                                    <div class="p-2 bg-slate-100 rounded-lg">
                                        <label for="moment-corrosion" class="block text-sm font-medium text-slate-700 mb-1">è…è•æ§åˆ¶å½çŸ© \(M_{corr}\)</label>
                                        <div class="relative">
                                            <input type="number" step="0.1" id="moment-corrosion" class="w-full p-2 border rounded-md bg-white text-center text-sm pr-12">
                                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 text-xs">kNÂ·m</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-4 text-center">
                                     <div>
                                        <h3 class="font-semibold text-slate-700 mb-1 text-sm">ç–²å‹</h3>
                                        <div id="durability-fatigue-result" class="result-box"></div>
                                        <div class="text-xs mt-1 text-slate-500">
                                            è¨ˆç®—æ‡‰åŠ›: <span id="stress-fatigue" class="font-bold">---</span> N/mmÂ²
                                        </div>
                                    </div>
                                     <div>
                                        <h3 class="font-semibold text-slate-700 mb-1 text-sm">è…è•</h3>
                                        <div id="durability-corrosion-result" class="result-box"></div>
                                        <div class="text-xs mt-1 text-slate-500">
                                            è¨ˆç®—æ‡‰åŠ›: <span id="stress-corrosion" class="font-bold">---</span> N/mmÂ²
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>

            <!-- Bottom Section: Descriptions -->
            <footer class="mt-8 space-y-6">
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h2 class="text-xl font-bold mb-2 text-sky-800">ğŸ›¡ï¸ è€è·æ€§èƒ½æª¢æ ¸ (æ¥µé™ç‹€æ…‹) è©³ç´°èªªæ˜</h2>
                    <dl class="mt-4 border-t border-slate-200 pt-4 text-sm text-slate-600 space-y-2">
                        <div class="flex">
                            <dt class="font-semibold text-slate-800 w-24 flex-shrink-0">æª¢æ ¸ç›®æ¨™ï¼š</dt>
                            <dd>ç¢ºä¿åœ¨è¨­è¨ˆè·è¼‰ä¸‹ï¼Œæ§‹ä»¶ä¸æœƒç™¼ç”Ÿé™ä¼ï¼ˆåŠŸèƒ½ç¶­æŒï¼‰æˆ–å´©å¡Œï¼ˆçµæ§‹å®‰å…¨ï¼‰ï¼Œä»¥ç¶­æŒå…¶æ­£å¸¸ä½¿ç”¨åŠŸèƒ½èˆ‡æœ€çµ‚å®‰å…¨æ€§ã€‚</dd>
                        </div>
                        <div class="flex">
                            <dt class="font-semibold text-slate-800 w-24 flex-shrink-0">è¦ç¯„ä¾†æºï¼š</dt>
                            <dd>ã€Šé“è·¯æ©‹ç¤ºæ–¹æ›¸ã€‹IIIç¯‡ é‹¼æ§‹é€ ç¯‡ 5.5.1 åŠ 5.7.1ã€‚</dd>
                        </div>
                        <div class="flex">
                            <dt class="font-semibold text-slate-800 w-24 flex-shrink-0">åˆ¤å®šåŸºæº–ï¼š</dt>
                            <dd class="w-full">
                                è¨­è¨ˆå½çŸ© \(M_d\) å¿…é ˆå°æ–¼æˆ–ç­‰æ–¼ç¶“ééƒ¨åˆ†ä¿‚æ•¸æŠ˜æ¸›å¾Œçš„æŠµæŠ—å½çŸ©ã€‚
                                <div class="mt-4">
                                    <b class="text-slate-800">1. é™ä¼å½çŸ© \(M_{yc}\) (æ¥µé™ç‹€æ…‹1 - åŠŸèƒ½ç¶­æŒ):</b>
                                    <ul class="list-disc pl-5 mt-1 space-y-1">
                                        <li><b>å®šç¾©:</b> ç•¶æ–·é¢å—æ‹‰å´é‹¼ç­‹æ‡‰è®Šé”åˆ°é™ä¼é» \(\epsilon_{sy}\)ï¼Œä¸”å£“åŠ›å´æ··å‡åœŸæ‡‰åŠ›ç‚º \( \frac{2}{3}f'_{ck} \) æ™‚çš„æŠµæŠ—å½çŸ©ã€‚</li>
                                        <li><b>è¨ˆç®—æ­¥é©Ÿ:</b>
                                            <ol class="list-decimal pl-5">
                                                <li>ä¾æ“šæ‡‰è®Šç›¸å®¹æ€§èˆ‡åŠ›å¹³è¡¡åŸå‰‡ (æ‹‰åŠ› = å£“åŠ›)ï¼Œå»ºç«‹æ–¹ç¨‹å¼æ±‚è§£ä¸­æ€§è»¸æ·±åº¦ \(c\)ã€‚</li>
                                                <li>è¨ˆç®—å£“åŠ›å´æ··å‡åœŸæ‡‰åŠ›å¡ŠåˆåŠ› \(C_c\)ã€å£“åŠ›å´é‹¼ç­‹ä½œç”¨åŠ› \(C_s\)ã€‚</li>
                                                <li>å°æ‹‰åŠ›å´é‹¼ç­‹ä¸­å¿ƒå–åŠ›çŸ©ï¼Œå³å¯æ±‚å¾—å½çŸ©: \(M_{yc} = C_c \cdot d_{cc} + C_s \cdot d_{sc}\)ï¼Œå…¶ä¸­ \(d\) ç‚ºåŠ›è‡‚ã€‚</li>
                                            </ol>
                                        </li>
                                    </ul>
                                </div>
                                <div class="mt-4">
                                    <b class="text-slate-800">2. ç ´å£æŠµæŠ—å½çŸ© \(M_{uc}\) (æ¥µé™ç‹€æ…‹3 - çµæ§‹å®‰å…¨):</b>
                                    <ul class="list-disc pl-5 mt-1 space-y-1">
                                         <li><b>å®šç¾©:</b> ç•¶æ–·é¢å£“åŠ›å´æ··å‡åœŸæ‡‰è®Šé”åˆ°æ¥µé™å£“æ‡‰è®Š \(\epsilon_{cu} = 0.0035\) æ™‚çš„æŠµæŠ—å½çŸ©ã€‚</li>
                                        <li><b>è¨ˆç®—æ­¥é©Ÿ:</b>
                                            <ol class="list-decimal pl-5">
                                                <li>æ¡ç”¨æƒ ç‰¹å°¼ç­‰å€¼æ‡‰åŠ›å¡Š (Whitney Stress Block) é€²è¡Œåˆ†æï¼Œå£“åŠ›å¡Šæ·±åº¦ \( a = \beta_1 c \)ã€‚</li>
                                                <li>é€éè¿­ä»£è¨ˆç®—ï¼Œæ±‚è§£æ»¿è¶³åŠ›å¹³è¡¡æ–¹ç¨‹å¼ \( T_s = C_c + C_s \) çš„ä¸­æ€§è»¸æ·±åº¦ \(c\)ã€‚</li>
                                                <li>å°æ‹‰åŠ›å´é‹¼ç­‹ä¸­å¿ƒå–åŠ›çŸ©ï¼Œå³å¯æ±‚å¾—å½çŸ©: \(M_{uc} = C_c(d - a/2) + C_s(d-d')\)ã€‚</li>
                                            </ol>
                                        </li>
                                    </ul>
                                </div>
                            </dd>
                        </div>
                    </dl>
                </div>
                 <div class="bg-white p-6 rounded-xl shadow-md">
                    <h2 class="text-xl font-bold mb-2 text-sky-800">ğŸ”„ ç›¸åæ‡‰åŠ›æ§‹ä»¶æª¢æ ¸ è©³ç´°èªªæ˜</h2>
                    <dl class="mt-4 border-t border-slate-200 pt-4 text-sm text-slate-600 space-y-2">
                         <div class="flex">
                            <dt class="font-semibold text-slate-800 w-24 flex-shrink-0">æª¢æ ¸ç›®æ¨™ï¼š</dt>
                            <dd>é‡å°åœ¨ä¸åŒè·è¼‰å·¥æ³ä¸‹ï¼Œå¯èƒ½ç™¼ç”Ÿå½çŸ©æ­£è² è™Ÿåè½‰çš„æ§‹ä»¶ï¼Œé€²è¡Œç‰¹åˆ¥çš„åŠ åš´æª¢æ ¸ï¼Œä»¥é˜²æ­¢å› æ‡‰åŠ›åè¦†é€†è½‰é€ æˆçš„ç–²å‹ç´¯ç©èˆ‡å…¶ä»–æ½›åœ¨é¢¨éšªã€‚</dd>
                        </div>
                         <div class="flex">
                            <dt class="font-semibold text-slate-800 w-24 flex-shrink-0">è¦ç¯„ä¾†æºï¼š</dt>
                            <dd>ã€Šé“è·¯æ©‹ç¤ºæ–¹æ›¸ã€‹IIIç¯‡ï¼ŒåŸºæ–¼å·¥ç¨‹å¯¦è¸æ‰€è¨‚ä¹‹ç‰¹åˆ¥æ¢æ¬¾ã€‚</dd>
                        </div>
                        <div class="flex">
                            <dt class="font-semibold text-slate-800 w-24 flex-shrink-0">åˆ¤å®šåŸºæº–ï¼š</dt>
                             <dd class="w-full">æ­¤æª¢æ ¸ç‚ºä¸€å¤šæ­¥é©Ÿçš„é‚è¼¯åˆ¤æ–·æµç¨‹ï¼Œæ—¨åœ¨ç¢ºä¿çµæ§‹åœ¨ç‰¹æ®Šè·è¼‰ä¸‹çš„å®‰å…¨æ€§ï¼š
                                <ul class="list-disc pl-5 mt-2 space-y-2">
                                    <li><b>æ­¥é©Ÿä¸€ (è­˜åˆ¥)ï¼š</b>åˆ¤æ–·æ§‹ä»¶å½çŸ©æ­£è² è™Ÿæ˜¯å¦æœƒå› æ°¸ä¹…è·è¼‰(D)èˆ‡æ´»è·è¼‰(L)çµ„åˆè€Œåè½‰ã€‚è‹¥æœƒï¼Œå‰‡æ­¤æ§‹ä»¶è¢«è¦–ç‚ºã€Œç›¸åæ‡‰åŠ›æ§‹ä»¶ã€ï¼Œéœ€é€²è¡Œå¾ŒçºŒåŠ åš´æª¢æ ¸ã€‚æ‡‰åŠ›åè¦†é€†è½‰æœƒåŠ é€Ÿç–²å‹æå‚·ï¼Œä¸¦å¯èƒ½å¼•ç™¼å–®å‘è·è¼‰ä¸‹ä¸æœƒå‡ºç¾çš„åŠ£åŒ–æ©Ÿåˆ¶ã€‚</li>
                                    <li><b>æ­¥é©ŸäºŒ (åŠ åš´)ï¼š</b>ç•¶ç›¸åæ‡‰åŠ›æ§‹ä»¶çš„æ°¸ä¹…è·è¼‰èˆ‡æ´»è·è¼‰æ•ˆæ‡‰å‡è¼ƒé¡¯è‘—æ™‚ï¼ˆè¦ç¯„ä»¥ \(|M_D/M_L| \ge 0.3\) ä½œç‚ºåˆ¤æ–·ä¾æ“šï¼‰ï¼Œå¿…é ˆæ¡ç”¨ä¸€çµ„æ›´ç‚ºåš´è‹›çš„è·è¼‰çµ„åˆä¾†è¨ˆç®—æª¢æ ¸ç”¨çš„è¨­è¨ˆå½çŸ©ã€‚æ­¤çµ„åˆæœƒæ”¾å¤§æ´»è·è¼‰çš„å½±éŸ¿ï¼ˆå¦‚ \(M_d = M_D + 1.3 \cdot M_L\)ï¼‰ï¼Œä»¥æ¨¡æ“¬æ›´æ¥µç«¯çš„ä½œç”¨åŠ›æƒ…æ³ã€‚</li>
                                    <li><b>æ­¥é©Ÿä¸‰ (åˆ¤å®š)ï¼š</b>ä½¿ç”¨æ­¤åŠ åš´å¾Œçš„è¨­è¨ˆå½çŸ©ï¼Œåˆ†åˆ¥èˆ‡æ¥µé™ç‹€æ…‹1åŠæ¥µé™ç‹€æ…‹3çš„æŠµæŠ—é™åˆ¶å€¼é€²è¡Œæ¯”è¼ƒã€‚å¿…é ˆ**åŒæ™‚æ»¿è¶³**é€™å…©å€‹æ¥µé™ç‹€æ…‹çš„è¦æ±‚ï¼Œæœ€çµ‚çš„æª¢æ ¸çµæœæ‰åˆ¤å®šç‚ºOKã€‚</li>
                                </ul>
                            </dd>
                        </div>
                    </dl>
                </div>
                 <div class="bg-white p-6 rounded-xl shadow-md">
                    <h2 class="text-xl font-bold mb-2 text-sky-800">â³ è€ä¹…æ€§èƒ½æª¢æ ¸ è©³ç´°èªªæ˜</h2>
                     <dl class="mt-4 border-t border-slate-200 pt-4 text-sm text-slate-600 space-y-2">
                        <div class="flex">
                            <dt class="font-semibold text-slate-800 w-24 flex-shrink-0">æª¢æ ¸ç›®æ¨™ï¼š</dt>
                            <dd>æ§åˆ¶çµæ§‹å› ç–²å‹èˆ‡é‹¼ç­‹è…è•å¼•ç™¼çš„é•·æœŸåŠ£åŒ–ï¼Œç¢ºä¿æ©‹æ¢åœ¨ç™¾å¹´è¨­è¨ˆä½¿ç”¨å¹´é™å…§çš„æœå‹™å“è³ªèˆ‡å®‰å…¨ã€‚</dd>
                        </div>
                         <div class="flex">
                            <dt class="font-semibold text-slate-800 w-24 flex-shrink-0">è¦ç¯„ä¾†æºï¼š</dt>
                            <dd>ã€Šé“è·¯æ©‹ç¤ºæ–¹æ›¸ã€‹IIIç¯‡ ä½¿ç”¨æ€§æ¥µé™ç‹€æ…‹ç›¸é—œè¦å®š (å¦‚ 7.2ç¯€ ç–²å‹ã€7.3ç¯€ è…è•æ§åˆ¶)ã€‚</dd>
                        </div>
                        <div class="flex">
                            <dt class="font-semibold text-slate-800 w-24 flex-shrink-0">åˆ¤å®šåŸºæº–ï¼š</dt>
                            <dd class="w-full">
                                é€éé™åˆ¶ç‰¹å®šè·è¼‰çµ„åˆä¸‹é‹¼ç­‹çš„æ‹‰æ‡‰åŠ›ï¼Œä¾†æ§åˆ¶æ··å‡åœŸçš„è£‚ç¸«å¯¬åº¦ï¼Œä»¥é”åˆ°è€ä¹…æ€§ç›®æ¨™ã€‚
                                <div class="mt-4">
                                    <b class="text-slate-800">1. ç–²å‹æª¢æ ¸:</b>
                                    <ul class="list-disc pl-5 mt-1 space-y-1">
                                        <li><b>ç›®çš„:</b> æ§åˆ¶è®Šå‹•è·è¼‰ï¼ˆå¦‚è»Šæµï¼‰ä½œç”¨ä¸‹è£‚ç¸«çš„åè¦†é–‹åˆï¼Œé˜²æ­¢é‹¼ç­‹ç–²å‹ã€‚</li>
                                        <li><b>è·è¼‰çµ„åˆ:</b> \( M_{fat} = 1.0 \cdot (D+L+PS+CR+SH+E+HP+U) \) </li>
                                        <li><b>æ‡‰åŠ›é™åˆ¶:</b> è¨ˆç®—å‡ºçš„é‹¼ç­‹æ‹‰æ‡‰åŠ› \(\sigma_s \le 180~N/mm^2\)ã€‚</li>
                                    </ul>
                                </div>
                                <div class="mt-4">
                                    <b class="text-slate-800">2. è…è•æ§åˆ¶æª¢æ ¸:</b>
                                    <ul class="list-disc pl-5 mt-1 space-y-1">
                                         <li><b>ç›®çš„:</b> æ§åˆ¶æ°¸ä¹…è·è¼‰ä½œç”¨ä¸‹çš„è£‚ç¸«å¯¬åº¦ï¼Œå¾æ ¹æœ¬ä¸Šé˜²æ­¢æˆ–å»¶ç·©è…è•å› å­ï¼ˆå¦‚æ°¯é›¢å­ï¼‰ä¾µå…¥ã€‚</li>
                                         <li><b>è·è¼‰çµ„åˆ:</b> \( M_{corr} \) æ¡ç”¨ã€Œæ°¸ä¹…ä½œç”¨æ”¯é…ç‹€æ³ã€ï¼Œå³åƒ…è€ƒæ…®æ†ä¹…å­˜åœ¨çš„è·è¼‰ã€‚</li>
                                         <li><b>æ‡‰åŠ›é™åˆ¶:</b> è¨ˆç®—å‡ºçš„é‹¼ç­‹æ‹‰æ‡‰åŠ› \(\sigma_s \le 100~N/mm^2\)ã€‚</li>
                                    </ul>
                                </div>
                                 <div class="mt-4">
                                    <b class="text-slate-800">é‹¼ç­‹æ‡‰åŠ›è¨ˆç®—æ­¥é©Ÿ:</b>
                                    <ol class="list-decimal pl-5 mt-1 space-y-1">
                                        <li>æ¡ç”¨ã€Œé–‹è£‚è½‰æ›æ–·é¢æ³•ã€ï¼Œå°‡é‹¼ç­‹é¢ç©è½‰æ›ç‚ºç­‰æ•ˆæ··å‡åœŸé¢ç© (\(nA_s\))ã€‚</li>
                                        <li>å°è½‰æ›å¾Œæ–·é¢çš„å½¢å¿ƒè»¸å–é¢ç©ä¸€æ¬¡çŸ©ï¼Œæ±‚è§£ä¸­æ€§è»¸æ·±åº¦ \(kd\)ã€‚</li>
                                        <li>è¨ˆç®—é–‹è£‚è½‰æ›æ–·é¢çš„æ…£æ€§çŸ© \(I_{cr}\)ã€‚</li>
                                        <li>ä½¿ç”¨æ’“æ›²å…¬å¼è¨ˆç®—é‹¼ç­‹æ‡‰åŠ›: \(\sigma_s = n \cdot \frac{M \cdot y}{I_{cr}}\)ï¼Œå…¶ä¸­ \(M\) ç‚ºå°æ‡‰çš„æª¢æ ¸å½çŸ©ï¼Œ\(y\) ç‚ºä¸­æ€§è»¸è‡³å—æ‹‰é‹¼ç­‹çš„è·é›¢ã€‚</li>
                                    </ol>
                                </div>
                            </dd>
                        </div>
                    </dl>
                </div>
            </footer>
        </div>
    </div>

<script>
    const designData = {
        sec15: {
            name: "è…¹ç‰ˆ Sec-15",
            dimensions: { W: 1000, H: 450, topCover: 50, botCover: 50 },
            rebar: { top: { type: 'D16', spacing: 15 }, bottom: { type: 'D16', spacing: 15 } },
            properties: { 'æ··å‡åœŸå¼·åº¦ f\'ck': '36 N/mmÂ²' },
            myc: { pos: 204.6, neg: 204.6 },
            muc: { pos: 215.4, neg: 215.4 },
            loadBearing: { designMoment: -80.3, limitState1Factor: 0.765, limitState3Factor: 0.648 },
            durability: { momentFatigue: -66.7, momentCorrosion: -16.3, fatigueLimit: 180, corrosionLimit: 100 },
            reversingStress: { momentD: -15.55, momentL: 67.21, checkResult: 'OK' }
        },
        sec16: {
            name: "è…¹ç‰ˆ Sec-16",
            dimensions: { W: 1000, H: 450, topCover: 50, botCover: 50 },
            rebar: { top: { type: 'D16', spacing: 15 }, bottom: { type: 'D16', spacing: 15 } },
            properties: { 'æ··å‡åœŸå¼·åº¦ f\'ck': '36 N/mmÂ²' },
            myc: { pos: 204.6, neg: 204.6 },
            muc: { pos: 215.4, neg: 215.4 },
            loadBearing: { designMoment: -80.3, limitState1Factor: 0.765, limitState3Factor: 0.648 },
            durability: { momentFatigue: -25.0, momentCorrosion: -12.3, fatigueLimit: 180, corrosionLimit: 100 },
            reversingStress: { momentD: -11.40, momentL: 16.77, checkResult: 'OK' }
        },
        sec24: {
            name: "ä¸‹ç¿¼ç‰ˆ Sec-24",
            dimensions: { W: 1000, H: 220, topCover: 50, botCover: 50 },
            rebar: { top: { type: 'D13', spacing: 15 }, bottom: { type: 'D13', spacing: 15 } },
            properties: { 'æ··å‡åœŸå¼·åº¦ f\'ck': '36 N/mmÂ²' },
            myc: { pos: 26.2, neg: 55.3 },
            muc: { pos: 27.5, neg: 58.5 },
            loadBearing: { designMoment: -21.9, limitState1Factor: 0.765, limitState3Factor: 0.648 },
            durability: { momentFatigue: -17.6, momentCorrosion: -6.1, fatigueLimit: 180, corrosionLimit: 100 },
            reversingStress: { momentD: 5.86, momentL: -12.65, checkResult: 'OK' }
        },
        sec25: {
            name: "ä¸‹ç¿¼ç‰ˆ Sec-25",
            dimensions: { W: 1000, H: 220, topCover: 50, botCover: 50 },
            rebar: { top: { type: 'D13', spacing: 15 }, bottom: { type: 'D13', spacing: 15 } },
            properties: { 'æ··å‡åœŸå¼·åº¦ f\'ck': '36 N/mmÂ²' },
            myc: { pos: 26.2, neg: 55.3 },
            muc: { pos: 27.5, neg: 58.5 },
            loadBearing: { designMoment: -21.9, limitState1Factor: 0.765, limitState3Factor: 0.648 },
            durability: { momentFatigue: 6.7, momentCorrosion: 6.2, fatigueLimit: 180, corrosionLimit: 100 },
            reversingStress: { momentD: -4.92, momentL: 12.36, checkResult: 'OK' }
        }
    };

    const rebarData = {
        'D10': { area: 71.33, dia: 9.53 },
        'D13': { area: 126.7, dia: 12.7 },
        'D16': { area: 198.6, dia: 15.9 },
        'D19': { area: 286.5, dia: 19.1 },
        'D22': { area: 387.1, dia: 22.2 },
        'D25': { area: 506.7, dia: 25.4 },
        'D29': { area: 642.4, dia: 28.6 },
        'D32': { area: 794.2, dia: 31.8 }
    };

    let currentSection = 'sec15';
    
    const drawSection = (canvas, sectionData) => {
        if (!canvas) return;
        
        const { H, W, topCover, botCover } = sectionData.dimensions;
        
        const dpi = window.devicePixelRatio || 1;
        const style_height = +getComputedStyle(canvas).getPropertyValue("height").slice(0, -2);
        const style_width = +getComputedStyle(canvas).getPropertyValue("width").slice(0, -2);
        canvas.setAttribute('height', style_height * dpi);
        canvas.setAttribute('width', style_width * dpi);

        const ctx = canvas.getContext('2d');
        ctx.scale(dpi, dpi);
        
        const canvasW = style_width;
        const canvasH = style_height;
        ctx.clearRect(0, 0, canvasW, canvasH);
        
        const h_scale = (canvasH * 0.6) / H;
        const w_scale = (canvasW * 0.5) / W;
        const scale = Math.min(h_scale, w_scale);

        const sectionWidth = W * scale;
        const sectionHeight = H * scale;

        const x = (canvasW - sectionWidth) / 2;
        const y = (canvasH - sectionHeight) / 2;
        
        ctx.strokeStyle = '#475569'; // slate-600
        ctx.lineWidth = 1.5;
        ctx.strokeRect(x, y, sectionWidth, sectionHeight);

        // Draw rebars
        const rebarRadius = 2.5;
        const topRebarCenterY = y + topCover * scale + rebarRadius;
        const botRebarCenterY = y + sectionHeight - botCover * scale - rebarRadius;
        
        ctx.fillStyle = '#1e293b'; // slate-800
        const rebarCount = 8;
        const rebarMargin = 15;

        for (let i = 0; i < rebarCount; i++) {
            const rebarX = x + rebarMargin + i * ((sectionWidth - 2 * rebarMargin) / (rebarCount - 1));
            ctx.beginPath();
            ctx.arc(rebarX, topRebarCenterY, rebarRadius, 0, 2 * Math.PI);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(rebarX, botRebarCenterY, rebarRadius, 0, 2 * Math.PI);
            ctx.fill();
        }

        // Draw dimensions
        const FONT_SIZE = 12 * 1.4;
        ctx.font = `bold ${FONT_SIZE}px "Noto Sans TC"`;
        ctx.fillStyle = '#334155';
        ctx.strokeStyle = '#64748b';
        ctx.lineWidth = 1;
        
        // Height dimension
        const dimX = x - 50;
        ctx.beginPath();
        ctx.moveTo(dimX, y); ctx.lineTo(dimX, y + sectionHeight);
        ctx.moveTo(dimX - 5, y); ctx.lineTo(dimX + 5, y);
        ctx.moveTo(dimX - 5, y + sectionHeight); ctx.lineTo(dimX + 5, y + sectionHeight);
        ctx.stroke();
        ctx.save();
        ctx.translate(dimX - 15, canvasH / 2);
        ctx.rotate(-Math.PI / 2);
        ctx.textAlign = 'center';
        ctx.fillText(`H = ${H}`, 0, 0);
        ctx.restore();
        
        // Width dimension
        const dimY = y - 40;
        ctx.beginPath();
        ctx.moveTo(x, dimY); ctx.lineTo(x + sectionWidth, dimY);
        ctx.moveTo(x, dimY - 5); ctx.lineTo(x, dimY + 5);
        ctx.moveTo(x + sectionWidth, dimY - 5); ctx.lineTo(x + sectionWidth, dimY + 5);
        ctx.stroke();
        ctx.textAlign = 'center';
        ctx.fillText(`W = ${W}`, canvasW / 2, dimY - 12);

        // Cover dimensions
        const COVER_FONT_SIZE = 10 * 1.4;
        ctx.font = `${COVER_FONT_SIZE}px "Noto Sans TC"`;
        const coverDimX = x + sectionWidth + 15;
        
        // Top Cover
        const topRebarEdgeY = topRebarCenterY - rebarRadius;
        ctx.beginPath();
        ctx.moveTo(coverDimX, y); ctx.lineTo(coverDimX, topRebarEdgeY);
        ctx.moveTo(coverDimX - 4, y); ctx.lineTo(coverDimX + 4, y);
        ctx.moveTo(coverDimX - 4, topRebarEdgeY); ctx.lineTo(coverDimX + 4, topRebarEdgeY);
        ctx.stroke();
        ctx.textAlign = 'left';
        ctx.fillText(topCover, coverDimX + 8, y + (topRebarEdgeY - y) / 2 + (COVER_FONT_SIZE / 3));

        // Bottom Cover
        const bottomRebarEdgeY = botRebarCenterY + rebarRadius;
        ctx.beginPath();
        ctx.moveTo(coverDimX, bottomRebarEdgeY); ctx.lineTo(coverDimX, y + sectionHeight);
        ctx.moveTo(coverDimX - 4, bottomRebarEdgeY); ctx.lineTo(coverDimX + 4, bottomRebarEdgeY);
        ctx.moveTo(coverDimX - 4, y + sectionHeight); ctx.lineTo(coverDimX + 4, y + sectionHeight);
        ctx.stroke();
        ctx.textAlign = 'left';
        ctx.fillText(botCover, coverDimX + 8, bottomRebarEdgeY + (y + sectionHeight - bottomRebarEdgeY) / 2 + (COVER_FONT_SIZE / 3));

    };
    
    const calculateYieldMoment = (inputs) => {
        const Es = 200000; // N/mm^2
        const yield_strain = 0.001725;
        const fy = Es * yield_strain;
        const fck = 36; // N/mm^2

        const W = inputs.W;
        const H = inputs.H;
        
        const top_rebar_spec = rebarData[inputs.topRebarType];
        const bot_rebar_spec = rebarData[inputs.botRebarType];

        const Ast = top_rebar_spec.area * (W / (inputs.topRebarSpacing * 10)); 
        const Asb = bot_rebar_spec.area * (W / (inputs.botRebarSpacing * 10)); 
        
        const dt = inputs.topCover + top_rebar_spec.dia / 2;
        const db = H - (inputs.botCover + bot_rebar_spec.dia / 2);

        // --- POSITIVE MOMENT CALCULATION ---
        let myc_pos = NaN;
        if (db > 0 && (db - dt) > 0) {
            const A = -(1/3) * fck * W;
            const B = (1/3) * fck * W * db + Ast * Es * yield_strain + Asb * fy;
            const C = -(Ast * Es * yield_strain * dt + Asb * fy * db);
            
            const discriminant = B*B - 4*A*C;
            if (discriminant >= 0) {
                const c1 = (-B + Math.sqrt(discriminant)) / (2 * A);
                const c2 = (-B - Math.sqrt(discriminant)) / (2 * A);
                let c_pos = (c1 > 0 && c1 < H) ? c1 : c2;
                
                if (c_pos > dt && c_pos < db) {
                    const Cc = (1/3) * fck * c_pos * W;
                    const strain_st = yield_strain * (c_pos - dt) / (db - c_pos);
                    const Cs = Ast * Es * strain_st;
                    myc_pos = (Cc * (db - c_pos/3) + Cs * (db - dt)) / 1e6;
                } else {
                    c_pos = (3 * Asb * fy) / (fck * W);
                    if (c_pos < db) {
                       myc_pos = (Asb * fy * (db - c_pos/3)) / 1e6;
                    }
                }
            }
        }
        
        // --- NEGATIVE MOMENT CALCULATION ---
        let myc_neg = NaN;
        const dt_neg = H - dt;
        const db_neg = H - db;
        
        if (dt_neg > 0 && (dt_neg - db_neg) > 0) {
            const A = -(1/3) * fck * W;
            const B = (1/3) * fck * W * dt_neg + Asb * Es * yield_strain + Ast * fy;
            const C = -(Asb * Es * yield_strain * db_neg + Ast * fy * dt_neg);
            
            const discriminant = B*B - 4*A*C;
            if (discriminant >= 0) {
                const c1 = (-B + Math.sqrt(discriminant)) / (2 * A);
                const c2 = (-B - Math.sqrt(discriminant)) / (2 * A);
                let c_neg = (c1 > 0 && c1 < H) ? c1 : c2;

                if (c_neg > db_neg && c_neg < dt_neg) {
                     const Cc = (1/3) * fck * c_neg * W;
                     const strain_sb = yield_strain * (c_neg - db_neg) / (dt_neg - c_neg);
                     const Cs = Asb * Es * strain_sb;
                     myc_neg = (Cc * (dt_neg - c_neg/3) + Cs * (dt_neg - db_neg)) / 1e6;
                } else {
                    c_neg = (3 * Ast * fy) / (fck * W);
                    if (c_neg < dt_neg) {
                       myc_neg = (Ast * fy * (dt_neg - c_neg/3)) / 1e6;
                    }
                }
            }
        }

        return { pos: myc_pos, neg: myc_neg };
    };
    
    const calculateUltimateMoment = (inputs) => {
        const Es = 200000;
        const fy = 345;
        const fck = 36;
        const Îµ_cu = 0.0035;
        const Î²1 = 0.8;

        const W = inputs.W;
        const H = inputs.H;

        const top_rebar_spec = rebarData[inputs.topRebarType];
        const bot_rebar_spec = rebarData[inputs.botRebarType];

        const Ast = top_rebar_spec.area * (W / (inputs.topRebarSpacing * 10));
        const Asb = bot_rebar_spec.area * (W / (inputs.botRebarSpacing * 10));

        const dt = inputs.topCover + top_rebar_spec.dia / 2;
        const db = H - (inputs.botCover + bot_rebar_spec.dia / 2);

        // --- POSITIVE MOMENT (Bottom tension) ---
        let muc_pos = NaN;
        let c = (Asb * fy) / (0.85 * fck * Î²1 * W); // Initial guess assuming no compression steel
        for (let i = 0; i < 10; i++) { // Iterate to find neutral axis c
            const Îµ_st = Îµ_cu * ((c - dt) / c);
            const f_st = Math.max(0, Math.min(Es * Îµ_st, fy)); // Compression steel stress, cannot be tension
            const T = Asb * fy;
            const C = 0.85 * fck * Î²1 * c * W + Ast * f_st;
            c = c * (T / C);
        }
        if (c > 0 && c < H) {
            const a = Î²1 * c;
            const Îµ_st = Îµ_cu * ((c - dt) / c);
            const f_st = Math.max(0, Math.min(Es * Îµ_st, fy));
            muc_pos = (Ast * f_st * (db - dt) + 0.85 * fck * a * W * (db - a / 2)) / 1e6;
        }


        // --- NEGATIVE MOMENT (Top tension) ---
        let muc_neg = NaN;
        const dt_neg = H - dt;
        const db_neg = H - db;
        c = (Ast * fy) / (0.85 * fck * Î²1 * W); // Initial guess
        for (let i = 0; i < 10; i++) {
            const Îµ_sb = Îµ_cu * ((c - db_neg) / c);
            const f_sb = Math.max(0, Math.min(Es * Îµ_sb, fy));
            const T = Ast * fy;
            const C = 0.85 * fck * Î²1 * c * W + Asb * f_sb;
            c = c * (T / C);
        }
        if (c > 0 && c < H) {
            const a = Î²1 * c;
            const Îµ_sb = Îµ_cu * ((c - db_neg) / c);
            const f_sb = Math.max(0, Math.min(Es * Îµ_sb, fy));
            muc_neg = (Asb * f_sb * (dt_neg - db_neg) + 0.85 * fck * a * W * (dt_neg - a / 2)) / 1e6;
        }

        return { pos: muc_pos, neg: muc_neg };
    };

    const calculateSteelStress = (inputs, moment) => {
        const n = 15; // Modular ratio
        const W = inputs.W;
        const H = inputs.H;
        
        const top_rebar_spec = rebarData[inputs.topRebarType];
        const bot_rebar_spec = rebarData[inputs.botRebarType];

        const Ast = top_rebar_spec.area * (W / (inputs.topRebarSpacing * 10)); 
        const Asb = bot_rebar_spec.area * (W / (inputs.botRebarSpacing * 10)); 
        
        const dt = inputs.topCover + top_rebar_spec.dia / 2;
        const db = H - (inputs.botCover + bot_rebar_spec.dia / 2);

        let stress = NaN;
        const M = Math.abs(moment) * 1e6; // to NÂ·mm

        if (moment >= 0) { // Positive moment, bottom steel in tension
            const A = W / 2;
            const B = (n - 1) * Ast + n * Asb;
            const C = -((n - 1) * Ast * dt + n * Asb * db);
            const kd = (-B + Math.sqrt(B*B - 4*A*C)) / (2*A);
            if (kd > 0 && kd < H) {
                const Icr = (W * kd**3) / 3 + (n - 1) * Ast * (kd - dt)**2 + n * Asb * (db - kd)**2;
                stress = n * M * (db - kd) / Icr;
            }
        } else { // Negative moment, top steel in tension
            const A = W / 2;
            const B = n * Ast + (n - 1) * Asb;
            const C = -(n * Ast * dt + (n - 1) * Asb * db);
            const kd = (-B + Math.sqrt(B*B - 4*A*C)) / (2*A);
            if (kd > 0 && kd < H) {
                const Icr = (W * kd**3) / 3 + n * Ast * (kd - dt)**2 + (n - 1) * Asb * (db - kd)**2;
                stress = n * M * (kd - dt) / Icr;
            }
        }
        return stress;
    };

    const runCalculationsAndDisplay = () => {
        const inputs = {
            W: parseFloat(document.getElementById('dim-w').value) || 0,
            H: parseFloat(document.getElementById('dim-h').value) || 0,
            topCover: parseFloat(document.getElementById('cover-top').value) || 0,
            botCover: parseFloat(document.getElementById('cover-bottom').value) || 0,
            topRebarType: document.getElementById('rebar-top-type').value,
            topRebarSpacing: parseFloat(document.getElementById('rebar-top-spacing').value) || 0,
            botRebarType: document.getElementById('rebar-bottom-type').value,
            botRebarSpacing: parseFloat(document.getElementById('rebar-bottom-spacing').value) || 0,
        };

        const mycPosDisplay = document.getElementById('myc-pos-display');
        const mycNegDisplay = document.getElementById('myc-neg-display');
        const mucPosDisplay = document.getElementById('muc-pos-display');
        const mucNegDisplay = document.getElementById('muc-neg-display');

        if (inputs.H <= 0 || inputs.topRebarSpacing <= 0 || inputs.botRebarSpacing <= 0) {
            mycPosDisplay.textContent = '---'; mycNegDisplay.textContent = '---';
            mucPosDisplay.textContent = '---'; mucNegDisplay.textContent = '---';
            designData[currentSection].myc = { pos: 0, neg: 0 };
            designData[currentSection].muc = { pos: 0, neg: 0 };
            return;
        }

        const calculatedMyc = calculateYieldMoment(inputs);
        const calculatedMuc = calculateUltimateMoment(inputs);
        
        designData[currentSection].myc.pos = isNaN(calculatedMyc.pos) ? 0 : calculatedMyc.pos;
        designData[currentSection].myc.neg = isNaN(calculatedMyc.neg) ? 0 : calculatedMyc.neg;
        designData[currentSection].muc.pos = isNaN(calculatedMuc.pos) ? 0 : calculatedMuc.pos;
        designData[currentSection].muc.neg = isNaN(calculatedMuc.neg) ? 0 : calculatedMuc.neg;

        mycPosDisplay.innerHTML = isNaN(calculatedMyc.pos) ? '<span class="text-rose-600">--</span>' : `${calculatedMyc.pos.toFixed(1)}`;
        mycNegDisplay.innerHTML = isNaN(calculatedMyc.neg) ? '<span class="text-rose-600">--</span>' : `-${calculatedMyc.neg.toFixed(1)}`;
        mucPosDisplay.innerHTML = isNaN(calculatedMuc.pos) ? '<span class="text-rose-600">--</span>' : `${calculatedMuc.pos.toFixed(1)}`;
        mucNegDisplay.innerHTML = isNaN(calculatedMuc.neg) ? '<span class="text-rose-600">--</span>' : `-${calculatedMuc.neg.toFixed(1)}`;
    };

    
    const renderEditableProperties = () => {
        const data = designData[currentSection];
        const propertiesDisplay = document.getElementById('properties-display');
        const rebarOptions = ['D10', 'D13', 'D16', 'D19', 'D22', 'D25', 'D29', 'D32'];
        
        propertiesDisplay.innerHTML = `
            <div class="flex justify-between items-center border-b pb-2">
                <span class="font-medium">æ§‹ä»¶åç¨±</span>
                <span class="font-bold text-sky-700 text-lg">${data.name}</span>
            </div>
             <div class="space-y-4 pt-2">
                <div>
                    <label class="font-medium text-base mb-2 block">æ–·é¢å°ºå¯¸ (mm)</label>
                    <div class="grid grid-cols-2 gap-x-6 gap-y-3">
                        <div>
                           <label for="dim-w" class="text-sm font-medium text-slate-600 block mb-1">å¯¬åº¦ W</label>
                           <input type="number" id="dim-w" value="${data.dimensions.W}" class="w-full p-2 border rounded-md bg-slate-200 text-center" readonly>
                        </div>
                        <div>
                           <label for="dim-h" class="text-sm font-medium text-slate-600 block mb-1">é«˜åº¦ H</label>
                           <input type="number" id="dim-h" value="${data.dimensions.H}" class="w-full p-2 border rounded-md bg-slate-50 text-center">
                        </div>
                        <div>
                           <label for="cover-top" class="text-sm font-medium text-slate-600 block mb-1">é ‚éƒ¨ä¿è­·å±¤</label>
                           <input type="number" id="cover-top" value="${data.dimensions.topCover}" class="w-full p-2 border rounded-md bg-slate-50 text-center">
                        </div>
                        <div>
                           <label for="cover-bottom" class="text-sm font-medium text-slate-600 block mb-1">åº•éƒ¨ä¿è­·å±¤</label>
                           <input type="number" id="cover-bottom" value="${data.dimensions.botCover}" class="w-full p-2 border rounded-md bg-slate-50 text-center">
                        </div>
                    </div>
                </div>
                 <div class="space-y-4 pt-2 border-t mt-4">
                    <label class="font-medium text-base">é‹¼ç­‹é…ç½®</label>
                     <div class="grid grid-cols-1 md:grid-cols-[120px,1fr] gap-x-4 gap-y-3 items-center">
                        <label for="rebar-top-type" class="text-sm">é ‚éƒ¨</label>
                        <div class="rebar-input-group">
                           <select id="rebar-top-type" class="w-full p-2 border rounded-md bg-slate-50">
                            ${rebarOptions.map(opt => `<option value="${opt}" ${data.rebar.top.type === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                           </select>
                           <div class="relative">
                            <input type="number" step="1" id="rebar-top-spacing" value="${data.rebar.top.spacing}" class="w-full p-2 border rounded-md bg-slate-50 pr-8 text-center">
                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 text-sm">cm</span>
                           </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-[120px,1fr] gap-x-4 gap-y-3 items-center">
                        <label for="rebar-bottom-type" class="text-sm">åº•éƒ¨</label>
                        <div class="rebar-input-group">
                           <select id="rebar-bottom-type" class="w-full p-2 border rounded-md bg-slate-50">
                            ${rebarOptions.map(opt => `<option value="${opt}" ${data.rebar.bottom.type === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                           </select>
                           <div class="relative">
                             <input type="number" step="1" id="rebar-bottom-spacing" value="${data.rebar.bottom.spacing}" class="w-full p-2 border rounded-md bg-slate-50 pr-8 text-center">
                             <span class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 text-sm">cm</span>
                           </div>
                        </div>
                    </div>
                </div>
                ${Object.entries(data.properties).map(([key, value]) => `
                    <div class="flex justify-between items-center border-t pt-4 mt-4">
                        <span class="font-medium">${key.replace("f'ck", " \\(f'_{ck}\\) ")}</span>
                        <span class="font-bold text-sky-700">${value.replace("N/mmÂ²", " \\(N/mm^2\\)")}</span>
                    </div>`
                ).join('')}
            </div>

            <div class="mt-4 p-2 bg-slate-50 rounded-lg flex justify-center items-center">
                <canvas id="section-canvas" width="800" height="500"></canvas>
            </div>
        `;
        
        const canvas = document.getElementById('section-canvas');
        drawSection(canvas, data);

        renderMathInElement(document.body);
        
        document.querySelectorAll('#properties-display input, #properties-display select').forEach(el => {
            el.addEventListener('input', updateStateAndRender);
        });
    };

    const updateStateAndRender = () => {
        const currentData = designData[currentSection];
        currentData.dimensions.H = parseFloat(document.getElementById('dim-h').value) || 0;
        currentData.dimensions.topCover = parseFloat(document.getElementById('cover-top').value) || 0;
        currentData.dimensions.botCover = parseFloat(document.getElementById('cover-bottom').value) || 0;
        currentData.rebar.top.type = document.getElementById('rebar-top-type').value;
        currentData.rebar.top.spacing = parseFloat(document.getElementById('rebar-top-spacing').value);
        currentData.rebar.bottom.type = document.getElementById('rebar-bottom-type').value;
        currentData.rebar.bottom.spacing = parseFloat(document.getElementById('rebar-bottom-spacing').value);
        
        runCalculationsAndDisplay();
        updateCheckResults();
        
        const canvas = document.getElementById('section-canvas');
        drawSection(canvas, currentData);
    };

    const updateCheckResults = () => {
        const data = designData[currentSection];
        const myc_pos = data.myc.pos || 0;
        const myc_neg = data.myc.neg || 0;
        const muc_pos = data.muc.pos || 0;
        const muc_neg = data.muc.neg || 0;
        
        const designMomentLs1 = parseFloat(document.getElementById('design-moment-ls1').value) || 0;
        const designMomentLs3 = parseFloat(document.getElementById('design-moment-ls3').value) || 0;

        const setResultStyle = (element, isOk) => {
            element.textContent = isOk ? 'OK' : 'NG';
            element.classList.remove('ok-result', 'ng-result');
            element.classList.add(isOk ? 'ok-result' : 'ng-result');
        };

        const myc_limit_raw = (designMomentLs1 >= 0) ? myc_pos : Math.abs(myc_neg);
        const limitState1Limit = myc_limit_raw * data.loadBearing.limitState1Factor;
        const isState1Ok = Math.abs(designMomentLs1) <= limitState1Limit;
        setResultStyle(document.getElementById('load-bearing-result-1'), isState1Ok);

        const ratio_ls1_val = myc_limit_raw > 0 ? (Math.abs(designMomentLs1) / myc_limit_raw) : 0;
        document.getElementById('ratio-ls1').textContent = ratio_ls1_val.toFixed(3);
 
        const muc_limit_raw = (designMomentLs3 >= 0) ? muc_pos : Math.abs(muc_neg);
        const limitState3Limit = muc_limit_raw * data.loadBearing.limitState3Factor;
        const isState3Ok = Math.abs(designMomentLs3) <= limitState3Limit;
        setResultStyle(document.getElementById('load-bearing-result-3'), isState3Ok);

        const ratio_ls3_val = muc_limit_raw > 0 ? (Math.abs(designMomentLs3) / muc_limit_raw) : 0;
        document.getElementById('ratio-ls3').textContent = ratio_ls3_val.toFixed(3);
        
        // Reversing Stress Check
        const momentD = parseFloat(document.getElementById('moment-d').value) || 0;
        const momentL = parseFloat(document.getElementById('moment-l').value) || 0;
        const dlRatio = (momentL !== 0) ? Math.abs(momentD / momentL) : 0;
        document.getElementById('dl-ratio').textContent = dlRatio.toFixed(3);

        let Md_revised;
        if (dlRatio >= 0.3) {
            Md_revised = momentD + 1.3 * momentL;
        } else {
            Md_revised = momentD + momentL; 
        }

        const checkMycLimit = (Md_revised >= 0) ? myc_pos : Math.abs(myc_neg);
        const checkMucLimit = (Md_revised >= 0) ? muc_pos : Math.abs(muc_neg);
        const isRevState1Ok = Math.abs(Md_revised) <= checkMycLimit * data.loadBearing.limitState1Factor;
        const isRevState3Ok = Math.abs(Md_revised) <= checkMucLimit * data.loadBearing.limitState3Factor;
        setResultStyle(document.getElementById('reversing-stress-result'), isRevState1Ok && isRevState3Ok);


        // Durability Checks
        const inputs = {
             W: parseFloat(document.getElementById('dim-w').value) || 0, H: parseFloat(document.getElementById('dim-h').value) || 0,
            topCover: parseFloat(document.getElementById('cover-top').value) || 0, botCover: parseFloat(document.getElementById('cover-bottom').value) || 0,
            topRebarType: document.getElementById('rebar-top-type').value, topRebarSpacing: parseFloat(document.getElementById('rebar-top-spacing').value) || 0,
            botRebarType: document.getElementById('rebar-bottom-type').value, botRebarSpacing: parseFloat(document.getElementById('rebar-bottom-spacing').value) || 0,
        };
        
        const momentFatigue = parseFloat(document.getElementById('moment-fatigue').value) || 0;
        const stressFatigue = calculateSteelStress(inputs, momentFatigue);
        document.getElementById('stress-fatigue').textContent = isNaN(stressFatigue) ? '---' : stressFatigue.toFixed(1);
        const isFatigueOk = isNaN(stressFatigue) ? false : stressFatigue <= data.durability.fatigueLimit;
        setResultStyle(document.getElementById('durability-fatigue-result'), isFatigueOk);

        const momentCorrosion = parseFloat(document.getElementById('moment-corrosion').value) || 0;
        const stressCorrosion = calculateSteelStress(inputs, momentCorrosion);
        document.getElementById('stress-corrosion').textContent = isNaN(stressCorrosion) ? '---' : stressCorrosion.toFixed(1);
        const isCorrosionOk = isNaN(stressCorrosion) ? false : stressCorrosion <= data.durability.corrosionLimit;
        setResultStyle(document.getElementById('durability-corrosion-result'), isCorrosionOk);
    };
    
    const renderAll = () => {
        const data = designData[currentSection];
        document.getElementById('design-moment-ls1').value = data.loadBearing.designMoment;
        document.getElementById('design-moment-ls3').value = data.loadBearing.designMoment;
        document.getElementById('moment-d').value = data.reversingStress.momentD;
        document.getElementById('moment-l').value = data.reversingStress.momentL;
        document.getElementById('moment-fatigue').value = data.durability.momentFatigue;
        document.getElementById('moment-corrosion').value = data.durability.momentCorrosion;

        renderEditableProperties();
        runCalculationsAndDisplay();
        updateCheckResults();
    }

    document.addEventListener('DOMContentLoaded', () => {
        try {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: "$$", right: "$$", display: true},
                    {left: "\\(", right: "\\)", display: false},
                    {left: "\\[", right: "\\]", display: true}
                ]
            });
        } catch (e) {
            console.error("KaTeX rendering failed", e);
        }

        document.querySelectorAll('#section-selector button').forEach(btn => {
            btn.addEventListener('click', (e) => {
                currentSection = e.currentTarget.dataset.section;
                document.querySelectorAll('#section-selector button').forEach(b => {
                    b.classList.toggle('active-btn', b.dataset.section === currentSection);
                    b.classList.toggle('inactive-btn', b.dataset.section !== currentSection);
                });
                renderAll();
            });
        });
        
        document.getElementById('design-moment-ls1').addEventListener('input', updateCheckResults);
        document.getElementById('design-moment-ls3').addEventListener('input', updateCheckResults);
        document.getElementById('moment-d').addEventListener('input', updateCheckResults);
        document.getElementById('moment-l').addEventListener('input', updateCheckResults);
        document.getElementById('moment-fatigue').addEventListener('input', updateCheckResults);
        document.getElementById('moment-corrosion').addEventListener('input', updateCheckResults);

        const initialBtn = document.getElementById('btn-sec15');
        initialBtn.classList.add('active-btn');
        initialBtn.classList.remove('inactive-btn');
        renderAll();
    });
</script>

</body>
</html>